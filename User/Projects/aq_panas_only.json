{
  "all_procs": {
    "procedure_1.csv": "item,code,max time,text,shuffle 1,survey,\r\n0,survey,user,This is the start of a new experiment.,off,autism_quotient.csv,\r\n0,survey,user,PANAS,off,panas.csv,\r\n0,instruct,user,The End.,off,,"
  },
  "conditions": "name,notes,stimuli,procedure,fullscreen,welcome,participant_id,end_message,start_message,buffer,scripts,\r\ncondition_1,You can put more detailed notes in this field,stimuli_1.csv,procedure_1.csv,off,,on,The End,Welcome to the AQ and PANAS,5,,",
  "all_stims": {
    "stimuli_1.csv": "cue,answer,\r\nA,Apple,\r\nB,Banana,\r\n,,"
  },
  "location": "zhao-haffey/eye-tracking-face-voice/aq_panas_only",
  "public_key": "MiWanD+agOxPh6o5QESNYLqaxoP2ujlQtIh0wCDHkRM=",
  "surveys": {
    "autism_quotient.csv": [
      [
        "item_name",
        "text",
        "Type",
        "Answers",
        "Values",
        "Score: AQ_Test",
        "Score: Social_Skill",
        "Score: Attention_switching",
        "Score: Communication",
        "Score: Imagination",
        "Score: Attention_to_detail",
        "Optional",
        "btn_width",
        "reversed"
      ],
      [
        "Instructions1",
        "<span style='color:#006699'><span style='font-size:20px'>Choose one response that best describes how strongly each item applies to you:</span></span>",
        "Instruct",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        ""
      ],
      [
        "AQ1",
        "I prefer to do things with others rather than on my own.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ2",
        "I prefer to do things the same way over and over again.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ3",
        "If I try to imagine something, I find it very easy to create a picture in my mind.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ4",
        "I frequently get so strongly absorbed in one thing that I lose sight of other things.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ5",
        "I often notice small sounds when others do not.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ6",
        "I usually notice car number plates or similar strings of information.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ7",
        "Other people frequently tell me that what I've said is impolite, even though I think it is polite.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ8",
        "When I'm reading a story, I can easily imagine what the characters might look like.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ9",
        "I am fascinated by dates.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ10",
        "In a social group, I can easily keep track of several different people's conversations.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ11",
        "I find social situations easy.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ12",
        "I tend to notice details that others do not.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ13",
        "I would rather go to a library than a party.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ14",
        "I find making up stories easy.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ15",
        "I find myself drawn more strongly to people than to things.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ16",
        "I tend to have very strong interests which I get upset about if I can't pursue.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ17",
        "I enjoy social chit-chat.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ18",
        "When I talk, it isn't always easy for others to get a word in edgeways.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ19",
        "I am fascinated by numbers.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ20",
        "When I'm reading a story, I find it difficult to work out the characters' intentions.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ21",
        "I don't particularly enjoy reading fiction.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ22",
        "I find it hard to make new friends.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ23",
        "I notice patterns in things all the time.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ24",
        "I would rather go to the theatre than a museum.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ25",
        "It does not upset me if my daily routine is disturbed.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ26",
        "I frequently find that I don't know how to keep a conversation going.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ27",
        "I find it easy to 'read between the lines' when someone is talking to me.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ28",
        "I usually concentrate more on the whole picture, rather than the small details.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ29",
        "I am not very good at remembering phone numbers.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ30",
        "I don't usually notice small changes in a situation, or a person's appearance.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ31",
        "I know how to tell if someone listening to me is getting bored.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ32",
        "I find it easy to do more than one thing at once.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ33",
        "When I talk on the phone, I'm not sure when it's my turn to speak.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ34",
        "I enjoy doing things spontaneously.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ35",
        "I am often the last to understand the point of a joke.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ36",
        "I find it easy to work out what someone is thinking or feeling just by looking at their face.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ37",
        "If there is an interruption, I can switch back to what I was doing very quickly.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ38",
        "I am good at social chit-chat.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ39",
        "People often tell me that I keep going on and on about the same thing.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "1",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ40",
        "When I was young, I used to enjoy playing games involving pretending with other children.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ41",
        "I like to collect information about categories of things (e.g. types of car, types of bird, types of train, types of plant, etc.).",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ42",
        "I find it difficult to imagine what it would be like to be someone else.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ43",
        "I like to plan any activities I participate in carefully.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ44",
        "I enjoy social occasions.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ45",
        "I find it difficult to work out people's intentions.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ46",
        "New situations make me anxious.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "1|1|0|0",
        "1",
        "",
        "1",
        "",
        "",
        "",
        "No",
        "100px",
        "no"
      ],
      [
        "AQ47",
        "I enjoy meeting new people.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ48",
        "I am a good diplomat.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "1",
        "",
        "",
        "",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ49",
        "I am not very good at remembering people's date of birth.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "",
        "1",
        "No",
        "100px",
        "yes"
      ],
      [
        "AQ50",
        "I find it very easy to play games with children that involve pretending.",
        "likert",
        "Definitely agree|Slightly agree|Slightly disagree|Definitely disagree",
        "0|0|1|1",
        "1",
        "",
        "",
        "",
        "1",
        "",
        "No",
        "100px",
        "yes"
      ],
      [
        ""
      ]
    ],
    "panas.csv": [
      [
        "item_name",
        "text",
        "type",
        "answers",
        "values",
        "score:panas_tot",
        "score:pos_aff",
        "score:neg_aff",
        "optional",
        "btn_width",
        ""
      ],
      [
        "Instructions1",
        "<span style='color:#006699'><span style='font-size:20px'>Choose one response that best describes how strongly each item applies to how you felt during the<b><u>first month of lockdown</u></b>:<br>\n<br>\nDuring the first month of lock down, I felt...</span></span>",
        "instruct",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        ""
      ],
      [
        "PANAS1",
        "Interested",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS2",
        "Distressed",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS3",
        "Excited",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS4",
        "Upset",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS5",
        "Strong",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS6",
        "Guilty",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS7",
        "Scared",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS8",
        "Hostile",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS9",
        "Enthusiastic",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS10",
        "Proud",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS11",
        "Irritable",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS12",
        "Alert",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS13",
        "Ashamed",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS14",
        "Inspired",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS15",
        "Nervous",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS16",
        "Determined",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS17",
        "Attentive",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS18",
        "Jittery",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS19",
        "Active",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "1",
        "1",
        "",
        "No",
        "100px",
        ""
      ],
      [
        "PANAS20",
        "Afraid",
        "likert",
        "Very slightly or not at all|A little|Moderately|Quite abit| Extremely",
        "1|2|3|4|5",
        "r1",
        "",
        "r1",
        "No",
        "100px",
        ""
      ],
      [
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        ""
      ]
    ]
  },
  "trialtypes": {},
  "code": {
    "instruct": "<!--\r\n/*  Collector (Garcia, Kornell, Kerr, Blake & Haffey)\r\n    A program for running experiments on the web\r\n    Copyright 2012-2016 Mikey Garcia & Nate Kornell\r\n\r\n\r\n    This program is free software: you can redistribute it and/or modify\r\n    it under the terms of the GNU General Public License version 3 as published by\r\n    the Free Software Foundation.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n    GNU General Public License for more details.\r\n\r\n    You should have received a copy of the GNU General Public License\r\n    along with this program.  If not, see <http://www.gnu.org/licenses/>\r\n \t\t\r\n\t\tKitten/Cat release (2019-2021) author: Dr. Anthony Haffey (team@someopen.solutions)\t\t\r\n*/\r\n-->\r\n<style>\r\n#instruct_text{\r\n  margin:auto;\r\n  width:500px;\r\n  padding:50px;\r\n  max-height:600px;\r\n  text-align: center;  \r\n}\r\n#proceed_button{\r\n  position:absolute;\r\n  right: 20px;\r\n}\r\n#trial_contents{\r\n  position: absolute;\r\n  top:0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  margin:auto;\r\n  width:600;\r\n  height:600;\r\n}\r\n</style>\r\n<div id=\"trial_contents\">\r\n  <div id=\"instruct_text\">{{text}}</div>\r\n  <div>\r\n    <button class=\"btn btn-primary\" id=\"proceed_button\" onclick=\"Phase.submit()\">Proceed</button>\r\n  </div>\r\n</div>",
    "survey": "<!--\r\n  Author: Dr. Anthony Haffey\r\n\r\n  Collector: Cat/Kitten/Cat release\r\n  A program for running experiments on the web\r\n  Copyright 2012-2018 Mikey Garcia & Nate Kornell\r\n\r\n  This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License version 3 as published by the Free Software Foundation.\r\n\r\n  This program is distributed in the hope that it will be useful,\r\n  but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n  GNU General Public License for more details.\r\n\r\n  You should have received a copy of the GNU General Public License\r\n  along with this program.  If not, see <http://www.gnu.org/licenses/>\r\n\r\n  Kitten/Cat release (2019-2021) author: Dr. Anthony Haffey\r\n\r\n  (team@someopen.solutions)\r\n-->\r\n<style>\r\nbody{\r\n  background-color:#5F9EA0;\r\n  width:100%;\r\n  height:100%;\r\n}\r\ntd{\r\n  padding:10px;\r\n  vertical-align: top;\r\n}\r\n\r\n/*\r\n*\telements by id\r\n*/\r\n\r\n#content{\r\n  width:95%;\r\n}\r\n#proceed_button{\r\n  display:none;\r\n  float:right;\r\n}\r\n#survey_outline{\r\n\tposition: \t\t\t\t\tfixed;\r\n  top: \t\t\t\t\t\t\t\t50%;\r\n  left: \t\t\t\t\t\t\t50%;\r\n\theight: \t\t\t\t\t\t90%;\r\n\toverflow: \t\t\t\t\tauto;\r\n\t-webkit-transform: \ttranslate(-50%, -50%);\r\n  transform: \t\t\t\t\ttranslate(-50%, -50%);\r\n  background-color: \twhite;\r\n\tmin-width:        \t900px;\r\n\tmax-width:        \t9000px;\r\n\tborder-radius:    \t20px;\r\n  border-color:     \t#006688;\r\n  border-style:     \tsolid;\r\n  border-width:     \t5px;\r\n\tpadding:            10px;\r\n  box-shadow:         12px 12px 12px rgba(0, 0, 0, 0.5);\r\n}\r\n#survey_tabs{\r\n  padding:            20px;\r\n}\r\n#this_survey_id{\r\n  padding:            20px;\r\n  display:            none;\r\n}\r\n\r\n/*\r\n*\telements by class\r\n*/\r\n.feedback_span_multiple{\r\n  display: none;\r\n  margin:  10px;\r\n}\r\n.feedback_span_single{\r\n  display: none;\r\n  padding: 10px;\r\n}\r\n.likert_table td{\r\n  padding:    1px;\r\n  text-align: center;\r\n}\r\n.likert_table td:hover{\r\n  color: blue;\r\n}\r\n.score_total{\r\n  display: none;\r\n}\r\n.show_tab{\r\n  margin: 5px;\r\n}\r\n.survey_btn{\r\n\twhite-space: normal;\r\n\tword-wrap: \t initial;\r\n}\r\n.table_break{\r\n\twidth:    100%;\r\n\theight:   300px;\r\n\toverflow: auto;\r\n}\r\n\r\n\r\n/*\r\n* by Bora Alp Arat at https://stackoverflow.com/questions/21684101/css-vertical-scrollbar-padding-left-right-in-ul-possible\r\n*/\r\n::-webkit-scrollbar {\r\n  width: 14px;\r\n  height: 18px;\r\n}\r\n::-webkit-scrollbar-thumb {\r\n  height: 6px;\r\n  border: 4px solid rgba(0, 0, 0, 0);\r\n  background-clip: padding-box;\r\n\t-webkit-border-radius: 7px;\r\n  background-color: rgba(0, 102, 153, 0.5);\r\n  -webkit-box-shadow: inset -1px -1px 0px rgba(0, 0, 0, 0.05), inset 1px 1px 0px rgba(0, 0, 0, 0.05);\r\n}\r\n::-webkit-scrollbar-button {\r\n  width: 0;\r\n  height: 0;\r\n  display: none;\r\n}\r\n::-webkit-scrollbar-corner {\r\n  background-color: transparent;\r\n}\r\n</style>\r\n<div id=\"everything\">\r\n\t<div id=\"survey_outline\"></div>\r\n</div>\r\n<span id=\"scales_span\"></span>\r\n<script>\r\n/*\r\n* Retrieving settings\r\n*/\r\n\r\nif(typeof(settings) !== \"undefined\"){\r\n  settings = [settings];\r\n} else {\r\n  settings = {};\r\n}\r\n\r\n/*\r\n* vertical vs. horizontal tabs\r\n*/\r\n\r\nif(typeof(settings.tab_hor_vert) == \"undefined\" || settings.tab_hor_vert.toLowerCase() == \"horizontal\"){\r\n  settings.tab_hor_vert = \"horizontal\";\r\n\r\n  $(\"#survey_outline\")\r\n    .append(\r\n      $(\"<div>\")\r\n        .attr(\"id\", \"please_wait_div\")\r\n        .html(\"Loading... Please wait\")\r\n    )\r\n    .append(\r\n      $(\"<div>\")\r\n        .addClass(\"needs-validation\")\r\n        .attr(\"id\", \"this_survey_id\")\r\n        .attr(\"novalidate\", true)\r\n    )\r\n    .append(\r\n      $(\"<div>\")\r\n        .attr(\"id\", \"survey_tabs\")\r\n        .addClass(\"border-top\")\r\n        .addClass(\"border-primary\")\r\n        .css(\"text-align\", \"right\")\r\n    )\r\n    .append(\r\n      $(\"<input>\")\r\n        .addClass(\"btn\")\r\n        .addClass(\"btn-primary\")\r\n        .attr(\"id\", \"proceed_button\")\r\n        .attr(\"type\", \"submit\")\r\n        .attr(\"value\", \"Proceed\")\r\n    );\r\n} else if (settings.tab_hor_vert.toLowerCase() == \"vertical\"){\r\n  $(\"#survey_outline\")\r\n    .append(\r\n      $(\"<table>\")\r\n        .append(\r\n          $(\"<tr>\")\r\n            .append(\r\n              $(\"<td>\")\r\n                .prop(\"valign\", \"top\")\r\n                .addClass(\"border-right\")\r\n                .addClass(\"border-primary\")\r\n                .append(\r\n                  $(\"<div>\")\r\n                    .prop(\"id\", \"survey_tabs\")\r\n                )\r\n            )\r\n            .append(\r\n              $(\"<td>\")\r\n                .append(\r\n                  $(\"<div>\")\r\n                    .prop(\"id\", \"please_wait_div\")\r\n                    .html(\"Please wait while survey is downloading\")\r\n                )\r\n                .append(\r\n                  $(\"<div>\")\r\n                    .prop(\"id\", \"this_survey_id\")\r\n                    .addClass(\"needs-validation\")\r\n                    .attr(\"novalidate\", true)\r\n                )\r\n                .append(\r\n                  $(\"<input>\")\r\n                    .attr(\"type\", \"button\")\r\n                    .addclass(\"btn\")\r\n                    .addclass(\"btn-primary\")\r\n                    .prop(\"id\", \"proceed_button\")\r\n                    .val(\"Proceed\")\r\n\r\n                )\r\n            )\r\n        )\r\n    );\r\n} else if(settings.tab_hor_vert.toLowerCase() == \"none\"){\r\n  $(\"#survey_outline\")\r\n    .append(\r\n      $(\"<div>\")\r\n        .css(\"display\", \"none\")\r\n        .prop(\"id\", \"survey_tabs\")\r\n    )\r\n    .append(\r\n      $(\"<div>\")\r\n        .html(\"Please wait while survey is downloading\")\r\n        .prop(\"id\", \"please_wait_div\")\r\n    )\r\n    .append(\r\n      $(\"<div>\")\r\n        .class(\"needs-validation\")\r\n        .prop(\"id\", \"this_survey_id\")\r\n        .attr(\"novalidate\", true)\r\n    );\r\n} else {\r\n  bootbox.alert(\"If you are the researcher, please check the 'settings for this survey. The input for 'tab_hor_vert' appears to be invalid. Please change it to 'horizontal' or 'vertical' or 'none' or remove 'tab_hot_vert' altogether from the settings, which will make the tabs invisible\");\r\n}\r\n\r\n/*\r\n* Defining objects\r\n*/\r\n\r\npage_break_management = {\r\n  breaks_remaining : 0,\r\n  breaks_index     : 0\r\n}\r\n\r\nproceed_object = {\r\n  type:[],\r\n  name:[],\r\n  break_no:[]\r\n};\r\n\r\nscoring_object={\r\n  scales:[],\r\n  scale_scores:[],\r\n  update_scales:function(this_survey){\r\n    headers = Object.keys(this_survey[0]);\r\n    this.scales = headers.filter(elm => elm.includes(\"score:\"));\r\n    var scales_html = '';\r\n    this.scales.forEach(function(element){\r\n      element = element.replace(\": \",\":\");\r\n      scales_html += \"<input name='\"+element.replace(/ |:/g,\"_\")+\"' class='score_total \"+element.replace(/ |:/g,\"_\")+\"' disabled>\";\r\n    });\r\n    $(\"#scales_span\").html(scales_html);\r\n  }\r\n}\r\n\r\nsurvey_obj = {};\r\n\r\n/*\r\n* Element actions\r\n*/\r\n\r\n/*\r\n$(function() {\r\n  $( \".datepicker\" ).datepicker({\r\n    dateFormat : 'mm/dd/yy',\r\n    changeMonth : true,\r\n    changeYear : true,\r\n    yearRange: '-100y:c+nn',\r\n    maxDate: '-1d'\r\n  });\r\n});\r\n*/\r\n\r\n\r\n$('#ExperimentContainer').css('transform','scale(1,1)');\r\n\r\n$(\"#proceed_button\").on(\"click\",function(){\r\n  var proceed = true;\r\n  var tabs    = document.getElementsByClassName('show_tab active');\r\n  if(tabs.length > 0){\r\n    var current_tab       = document.getElementsByClassName(\r\n      'show_tab active')[0]\r\n        .id\r\n        .replace(\"_button\", \"\")\r\n        .replace(\"tab_\",    \"\");\r\n    var response_elements = $('#table_'+current_tab).find('.response_element');\r\n\r\n  } else {\r\n    response_elements = $(\".table_break:visible\").find(\".response_element\");\r\n  }\r\n  for(var i = 0; i < response_elements.length; i++){\r\n    [row_no,item_name] = retrieve_row_no_item_name(response_elements[i]);\r\n    if(typeof(survey_obj.data[row_no].optional) !== \"undefined\"){\r\n      var this_optional = survey_obj.data[row_no].optional.toLowerCase();\r\n\r\n      if(this_optional.indexOf(\"no\") !== -1){\r\n        this_optional = this_optional.split(\"-\");       // find out whether there's a minimal number of responses\r\n        if(this_optional.length == 1){                  // default is that length needs to be at least 1\r\n          var min_resp_length = 1;\r\n        } else if(this_optional.length == 2) {\r\n          var min_resp_length = this_optional[1];\r\n        } else {\r\n          bootbox.alert(\"Error - you appear to have too many '-' characters in the 'optional' column\");\r\n          return false;\r\n        }\r\n      } else {\r\n        min_resp_length = 0;\r\n      }\r\n\r\n      var quest_resp = isJSON($(\"#\"+response_elements[i].id).val());\r\n      if (quest_resp.length < min_resp_length){\r\n        proceed = false;\r\n  \t\t\t$(\"#\"+response_elements[i].id.replace(\"response\",\"question\"))\r\n          .removeClass(\"text-dark\")\r\n          .removeClass(\"text-success\")\r\n          .addClass(\"text-danger\");\r\n      } else {\r\n  \t\t\t$(\"#\"+response_elements[i].id.replace(\"response\",\"question\"))\r\n          .removeClass(\"text-dark\")\r\n          .removeClass(\"text-danger\")\r\n          .addClass(\"text-success\");\r\n      }\r\n    }\r\n  }\r\n\r\n  if(current_tab == survey_obj.tabs && proceed){\r\n    if(typeof(sql_surveys) == \"undefined\"){\r\n      var next_table_no = parseFloat($(\".table_break:visible\")[0].id.replace(\"table\",\"\")) + 1;\r\n\r\n      if($(\".table_break#table\"+next_table_no).length == 0){\r\n        if(typeof(Phase) !== \"undefined\"){\r\n          Phase.submit();\r\n        } else {\r\n          bootbox.alert(\"You've finished! Click on the preview button to restart.\")\r\n        }\r\n      } else {\r\n        $(\".table_break\").hide();\r\n        $(\".table_break#table\" + next_table_no).show();\r\n      }\r\n    } else {\r\n      $(\"#survey_outline\").append(\r\n        $(\"<h1>\").html(\"You have finished the preview of this survey.\")\r\n      );\r\n    }\r\n  } else if(current_tab < survey_obj.tabs && proceed) {\r\n    current_tab ++;\r\n    $(\"#tab_\"+current_tab+\"_button\").removeClass(\"btn-secondary\");\r\n    $(\"#tab_\"+current_tab+\"_button\").removeClass(\"disabled\");\r\n    $(\"#tab_\"+current_tab+\"_button\").addClass(\"btn-outline-dark\");\r\n    $(\"#tab_\"+current_tab+\"_button\").click();\r\n  } else if(proceed == false){\r\n    bootbox.alert(\"You're missing some responses. Please fill in all the answers for the questions in red above.\");\r\n  } else if(current_tab > survey_obj.tabs){\r\n    bootbox.alert(\"Error - please contact Scientific Open Solutions about this problem, error 'Survey_001'.\");\r\n  }\r\n});\r\n\r\n//by qwerty at https://stackoverflow.com/questions/2116558/fastest-method-to-replace-all-instances-of-a-character-in-a-string\r\nString.prototype.replaceAll = function(str1, str2, ignore){\r\n  return this.replace(new RegExp(str1.replace(/([\\/\\,\\!\\\\\\^\\$\\{\\}\\[\\]\\(\\)\\.\\*\\+\\?\\|\\<\\>\\-\\&])/g,\"\\\\$&\"),(ignore?\"gi\":\"g\")),(typeof(str2)==\"string\")?str2.replace(/\\$/g,\"$$$$\"):str2);\r\n}\r\n\r\n\r\n/*\r\n* Functions\r\n*/\r\n\r\nfunction clean_item(this_item){\r\n  if(this_item.indexOf(\"'\") !== -1 |\r\n     this_item.indexOf('\"') !== -1){\r\n    bootbox.alert(\"Please avoid apostraphes or quote marks in the responses the participant can give. These cause problems with smooth running of surveys. This occurs when you wrote:<br><br>\" + this_item);\r\n  }\r\n  return(this_item);\r\n}\r\n\r\nfunction generate_feedback_string(feedback_array, this_index, feedback_color, row){\r\n  if(feedback_array){\r\n    if(feedback_array.length > 1){\r\n      return $(\"<div>\")\r\n        .addClass(\r\n          \"feedback_span_multiple\"       +\r\n          row[\"item_name\"].toLowerCase() +\r\n          \"_feedback\"\r\n        )\r\n        .html(feedback_array[this_index])[0].outerHTML;\r\n    } else {\r\n      return $(\"<div>\")\r\n        .addClass(\r\n          \"feedback_span_single \"        +\r\n          row[\"item_name\"].toLowerCase() +\r\n          \"_feedback\"\r\n        )\r\n        .css(\"color\", feedback_color[this_index])\r\n        .html(feedback_array[this_index])[0].outerHTML;\r\n    }\r\n  } else {\r\n    return \"\";\r\n  }\r\n}\r\n\r\nfunction get_feedback(row){\r\n  if(typeof(row[\"feedback\"]) !== \"undefined\" && row[\"feedback\"] !== \"\"){\r\n    feedback_array = row[\"feedback\"].split(\"|\");\r\n    if(typeof(row[\"feedback_color\"]) == \"undefined\"){\r\n      bootbox.alert(\"The color for the feedback options has not been set. If you created this questionnaire, please add a column 'feedback_color' to your survey and separate the colors by a pipe (|) character.\");\r\n    }\r\n    feedback_color = row[\"feedback_color\"].split(\"|\");\r\n  } else {\r\n    feedback_array = null;\r\n    feedback_color = '';\r\n  }\r\n  return [feedback_array,feedback_color];\r\n}\r\n\r\nfunction isJSON(str) {\r\n  try {\r\n    return JSON.parse(str);\r\n  } catch (e) {\r\n    return str;\r\n  }\r\n}\r\n\r\nfunction likert_update(this_element){\r\n  [row_no,item_name] = retrieve_row_no_item_name(this_element);\r\n  $(\".row_\"+row_no)\r\n    .removeClass(\"active\")\r\n    .removeClass(\"btn-primary\")\r\n    .addClass(\"btn-outline-primary\");\r\n  $(this_element)\r\n    .removeClass(\"btn-outline-primary\")\r\n    .addClass(\"btn-primary\");\r\n  $(\"#survey_\" + item_name + \"_response\").val(this_element.innerHTML);\r\n  $(\"#survey_\" + item_name + \"_value\").val(this_element.value);\r\n\r\n\r\n\r\n  response_check(this_element);\r\n}\r\n\r\nfunction load_survey(survey){\r\n  /*\r\n  * are we in preview?\r\n  */\r\n  if(typeof(parent.collector_survey_preview) !== \"undefined\"){\r\n    survey_content = survey;\r\n  } else if(typeof(parent.master) !== \"undefined\" && parent.master.surveys.preview){\r\n    survey_content = survey;\r\n    survey_obj.mods = parent.master.mods;\r\n  } else {\r\n    survey = survey.toLowerCase().replace(\".csv\",\"\") + \".csv\";\r\n\r\n    if(typeof(parent.parent.project_json.surveys) !== \"undefined\" &&\r\n       typeof(parent.parent.project_json.surveys[survey]) !== \"undefined\"){\r\n      survey_content = parent.parent.project_json.surveys[survey];\r\n      survey_obj.mods = parent.parent.project_json.mods;\r\n\r\n    } else if(\r\n      typeof(parent.parent.project_json.surveys) !== \"undefined\" &&\r\n      typeof(parent.parent.project_json.surveys[\r\n        survey.replace(\".csv\",\"\")\r\n      ])\r\n    ){\r\n\t\t\tsurvey_content = parent.parent.project_json.surveys[survey.replace(\".csv\",\"\")];\r\n      survey_obj.mods = parent.parent.project_json.mods;\r\n\t\t}\telse {\r\n      bootbox.alert(\"Survey \" + survey  + \" doesn't appear to exist\");\r\n    }\r\n  }\r\n  process_returned_questionnaire(survey_content);\r\n}\r\n\r\nfunction process_question(row, row_no){\r\n  //row.values = row.values == \"\" ? row.answers : row.values;\r\n  if(row_check(\"page_break\", row)){\r\n    page_break_management.breaks_remaining++;\r\n    question_td = \"</tr></table><table id='table\" +\r\n      page_break_management.breaks_remaining +\r\n      \"' style='display:none' class='table_break'></tr>\";\r\n  } else {\r\n    if(\r\n      typeof(row[\"values\"]) !== \"undefined\" & typeof(row[\"values\"]) !== \"function\"\r\n    ){ //to address microsoft edge issue.\r\n      value_array = row[\"values\"].split(\"|\");\r\n    } else {\r\n      value_array='';\r\n    }\r\n\r\n    if(row[\"item_name\"].indexOf(\" \") !== -1){\r\n      bootbox.alert(\"Please note that the 'item name' '\" +\r\n        row['item_name'] +\r\n        \"' is invalid because it has at least one space. Please use underscores instead of spaces. If you're not the creator of this task, please contact the person who created it.\"\r\n      );\r\n    }\r\n\r\n    /*\r\n    * class for scoring\r\n    */\r\n\r\n    var this_class = \"\";\r\n    for(var i=0;i<scoring_object.scales.length;i++){\r\n      if(row[scoring_object.scales[i].toLowerCase()]==\"1\"){\r\n        this_class += scoring_object.scales[i].toLowerCase().replace(\r\n          \"score: \",\"\"\r\n        ).replace(/ |-/,\"\") + \" \";\r\n      }\r\n      if(row[scoring_object.scales[i].toLowerCase()]==\"r1\"){\r\n        this_class += scoring_object.scales[i].toLowerCase().replace(\"score: \",\"\").replace(\" \",\"_\")+\"-r1 \";\r\n      }\r\n    }\r\n\r\n    /*\r\n    * adding to row to help with \"write\" function\r\n    */\r\n    var row_x = JSON.parse(\r\n      JSON.stringify(row)\r\n    );\r\n    row_x[\"row_no\"] = row_no;\r\n    row_x[\"this_class\"] = this_class;\r\n\r\n    [feedback_array,feedback_color] = get_feedback(row);\r\n\r\n    var survey_id = \"survey_\" + row[\"item_name\"].toLowerCase();\r\n\r\n    question_td = $(\"<input>\")\r\n      .attr(\"type\", \"hidden\")\r\n      .addClass(\"response_element row_\" + row_no)\r\n      .prop(\"id\",   survey_id + \"_response\")\r\n      .prop(\"name\", survey_id + \"_response\")\r\n      .val(\"\")[0].outerHTML +\r\n      $(\"<input>\")\r\n        .attr(\"type\", \"hidden\")\r\n        .addClass(\"response_element row_\" + row_no)\r\n        .prop(\"id\",   survey_id + \"_value\")\r\n        .prop(\"name\", survey_id + \"_value\")\r\n        .val(\"\")[0].outerHTML;\r\n\r\n    /*\r\n    * Survey settings\r\n    */\r\n    [row_ques_perc,row_resp_perc] = row_perc(row[\"question_width\"]);\r\n\r\n    if(typeof(settings.feedback_before_response) == \"undefined\"){\r\n      settings.feedback_before_response = true;\r\n    }\r\n\r\n    if(typeof(settings.lock_after_feedback) == \"undefined\"){\r\n      settings.lock_after_feedback = false;\r\n    }\r\n\r\n    if(typeof(row[\"type\"]) == \"undefined\"){\r\n      return false;\r\n    }\r\n\r\n    if(\r\n      typeof(survey_obj.mods) !== \"undefined\" &&\r\n\t\t\ttypeof(survey_obj.mods[row.type]) !== \"undefined\"\r\n    ){\r\n      var mod_html = survey_obj.mods[row.type].contents;\r\n\r\n      Object.keys(row).forEach(function(attribute){\r\n        mod_html = mod_html.replaceAll(\"{{\"+attribute+\"}}\",row[attribute]);\r\n      });\r\n      question_td += mod_html;\r\n    } else {\r\n      switch(row[\"type\"].toLowerCase()){\r\n        case \"page_start\":\r\n          //var tabs_html = $(\"#survey_tabs\").html();\r\n          if(settings.tab_hor_vert == \"horizontal\"){\r\n            span_div = \"span\";\r\n          } else if(settings.tab_hor_vert == \"vertical\"){\r\n            span_div = \"div\";\r\n          }\r\n          if(typeof(survey_obj.tabs) == \"undefined\"){\r\n            survey_obj.tabs = 0;\r\n          } else {\r\n            survey_obj.tabs++;\r\n          }\r\n          if(survey_obj.tabs == 0){ //i.e. is the first tab\r\n            active_button = \"btn-outline-primary active\";\r\n          } else {\r\n            active_button = \"btn-secondary disabled\";\r\n          }\r\n          if(settings.tab_hor_vert == \"vertical\"){\r\n            var vert_btn_block = \"btn-block\";\r\n          } else {\r\n            var vert_btn_block = \"\";\r\n          }\r\n          $(\"#survey_tabs\").append(\r\n            $(\"<\" + span_div + \">\")\r\n              .addClass(\"btn-group-toggle\")\r\n              .attr(\"data-toggle\", \"buttons\")\r\n              .append(\r\n                $(\"<label>\")\r\n                  .addClass(\"btn\")\r\n                  .addClass(\"show_tab\")\r\n                  .html(row[\"text\"])\r\n                  .prop(\"id\", \"tab_\" + survey_obj.tabs + \"_button\")\r\n                  .append(\r\n                    $(\"<input>\")\r\n                      .attr(\"autocomplete\", \"off\")\r\n                      .attr(\"checked\", true)\r\n                      .attr(\"type\", \"checkbox\")\r\n                  )\r\n              )[0].outerHTML\r\n          );\r\n\r\n          page_break_indexes = [];\r\n          survey_obj.data.forEach(function(row,this_index){\r\n            if(typeof(row.type) !== \"undefined\" && row.type.toLowerCase() == \"page_start\"){\r\n              page_break_indexes.push(this_index);\r\n            }\r\n          });\r\n\r\n          if(survey_obj.tabs > 0){\r\n            question_td\r\n              .append(\r\n                $(\"<div>\")\r\n                  .addClass(\"survey_page\")\r\n                  .css(\"display\", \"none\")\r\n                  .prop(\"id\", \"tab_\" + survey_obj.tabs)\r\n              )\r\n              .append(\r\n                $(\"<table>\")\r\n                  .addClass(\"table_break\")\r\n                  .prop(\"id\", \"table_\" + survey_obj.tabs)\r\n                  .append(\"<tr>\")\r\n              );\r\n\r\n          } else {\r\n\r\n            question_td\r\n              .append(\r\n                $(\"<div>\")\r\n                  .addClass(\"survey_page\")\r\n                  .prop(\"id\", \"tab_\" + survey_obj.tabs)\r\n              )\r\n              .append(\r\n                $(\"<table>\")\r\n                  .addClass(\"table_break\")\r\n                  .prop(\"id\", \"table_\" + survey_obj.tabs)\r\n                  .append(\"<tr>\")\r\n              );\r\n          }\r\n          break;\r\n        case \"checkbox\":\r\n        case \"checkbox_vertical\":\r\n          question_td += write(\"checkbox_vertical\",row_x);\r\n          break;\r\n        case \"checkbox_horizontal\":\r\n          question_td += write(\"checkbox_horizontal\",row_x);\r\n          break;\r\n        case \"checkbox_single\":\r\n          question_td += write(\"checkbox_single\", row_x);\r\n          break;\r\n        case \"date\":\r\n          question_td += write(\"date\",row_x);\r\n        break;\r\n        case \"dropdown\":\r\n\t\t\t\tcase \"select\":\r\n          question_td += write(\"dropdown\",row_x);\r\n        break;\r\n        case \"email\":\r\n          question_td += write(\"email\", row_x);\r\n        break;\r\n        case \"google_slide\":\r\n        case \"jumbled\":\r\n        case \"instruct\":\r\n          // these are defined elsewhere to take the whole row\r\n          break;\r\n        case \"likert\":\r\n          question_td += write(\"likert\", row_x);\r\n        break;\r\n        case \"number\":\r\n          question_td += write(\"number\", row_x);\r\n          break;\r\n        case \"para\":\r\n          question_td += write(\"para\", row_x);\r\n          break;\r\n        case \"radio\":\r\n        case \"radio_vertical\":\r\n          question_td += write(\"radio_vertical\", row_x);\r\n          break;\r\n        case \"radio_horizontal\":\r\n          question_td += write(\"radio_horizontal\", row_x);\r\n        break;\r\n\r\n        case \"report_score\":\r\n            question_td.append(\r\n              $(\"<input>\")\r\n                .addClass(\"form-control\")\r\n                .addClass(\"score_\" + row[\"item_name\"])\r\n                .addClass(row[\"item_name\"] + \"_item\")\r\n                .addClass(\"row_\" + row_no)\r\n                .attr(\"disabled\", true)\r\n                .attr(\"type\", \"text\")\r\n                .prop(\r\n                  \"name\",\r\n                  \"survey_\" + row[\"item_name\"].toLowerCase()\r\n                )\r\n            )\r\n        break;\r\n\r\n        case \"text\":\r\n          question_td += write(\"text\", row_x);\r\n        break;\r\n      }\r\n    }\r\n    if(feedback_array){\r\n        question_td.append(\r\n          $(\"<button>\")\r\n            .addClass(\"btn\")\r\n            .addClass(\"btn-outline-info\")\r\n            .addClass(\"feedback_btn\")\r\n            .addClass(row[\"item_name\"] + \"_item\")\r\n            .addClass(\"row_\" + row_no)\r\n            .html(\"Show\")\r\n            .on(\"click\", function(){\r\n              reveal_answers(this)\r\n            })\r\n            .prop(\r\n              \"id\",\r\n              \"reveal_\" + row[\"item_name\"].toLowerCase() + \"_feedback\"\r\n            )\r\n        )\r\n    }\r\n  }\r\n  if(typeof(row[\"type\"])== \"undefined\"){\r\n      return '';\r\n  } else {\r\n    if(row[\"type\"].toLowerCase() == \"instruct\"){\r\n      row_html  = write(\"instruct\",row);\r\n    } else if(row[\"type\"].toLowerCase() == \"jumbled\"){\r\n      //row_html  = question_td + write(\"jumbled\",row); <-- this is better, but being paused for placement work Anthony is doing\r\n      row_html  = write(\"jumbled\",row);\r\n\t\t} else if(row[\"type\"].toLowerCase() == \"likert\"){\r\n\r\n\t\t\tif(typeof(row[\"side_by_side\"]) !== \"undefined\" &&\r\n\t\t\t\t row[\"side_by_side\"].toLowerCase() == \"yes\"){\r\n\r\n        var row_html = $(\"<td>\")\r\n          .addClass(\"text-primary\")\r\n          .css(\"text-align\", \"right\")\r\n          .css(\"width\", row_ques_perc)\r\n          .html(row[\"text\"])\r\n          .prop(\r\n            \"id\",\r\n            \"survey_\" +\r\n              row[\"item_name\"]\r\n                .toLowerCase()\r\n                .replace(\" \",\"_\") +\r\n              \"_question\"\r\n          )[0].outerHTML +\r\n          $(\"<td>\").html(question_td)[0].outerHTML;\r\n\t\t\t} else {\r\n        var row_html = $(\"<tr>\")\r\n          .append(\r\n            $(\"<td>\")\r\n              .attr(\"colspan\", 2)\r\n              .html(row[\"text\"])\r\n          )[0].outerHTML +\r\n          $(\"<tr>\")\r\n            .append(\r\n              $(\"<td>\")\r\n                .attr(\"colspan\", 2)\r\n                .attr(\"align\", \"center\")\r\n                .html(question_td)\r\n            )[0].outerHTML;\r\n\t\t\t}\r\n    } else if(row[\"type\"].toLowerCase()==\"google_slide\") {\r\n      var row_html = $(\"<td>\")\r\n        .attr(\"colspan\", 2)\r\n        .html(row[\"text\"])[0].outerHTML;\r\n\r\n      //var row_html=\"<td colspan='2'>\"+row[\"text\"]+\"</label></td>\";\r\n    } else if(typeof(row[\"no_text\"]) !== \"undefined\" && row[\"no_text\"] == \"on\"){\r\n      var row_html = $(\"<td>\")\r\n        .attr(\"colspan\", 2)\r\n        .html(question_td)[0].outerHTML;\r\n\r\n      //var row_html=\"<td colspan='2'>\"+question_td+\"</td>\";\r\n    } else {\r\n      if(row['text'].toLowerCase() == \"page_start\" | row['type'].toLowerCase() == \"page_start\"){\r\n        row_html = question_td;\r\n      } else {\r\n        var row_html = $(\"<td>\")\r\n          .addClass(\"text-primary\")\r\n          .css(\"text-align\", \"right\")\r\n          .css(\"width\", row_ques_perc)\r\n          .html(row[\"text\"])\r\n          .prop(\r\n            \"id\",\r\n            \"survey_\" +\r\n              row[\"item_name\"].toLowerCase().replace(\" \",\"_\") +\r\n              \"_question\"\r\n          )[0].outerHTML +\r\n          $(\"<td>\")\r\n            .html(question_td)[0].outerHTML\r\n      }\r\n    }\r\n    if(typeof(row[\"optional\"]) !== \"undefined\"){\r\n      if(row[\"optional\"].toLowerCase() == \"no\"){\r\n        proceed_object.name.push(row[\"item_name\"]);\r\n        proceed_object.type.push(row[\"type\"]);\r\n        proceed_object.break_no.push(page_break_management.breaks_remaining);\r\n      }\r\n    }\r\n    if(typeof(row[\"shuffle_question\"]) == \"undefined\" || row[\"shuffle_question\"].toLowerCase() == \"off\"){\r\n      this_shuffle='none';\r\n    } else {\r\n      this_shuffle=row[\"shuffle_question\"];\r\n    }\r\n    return [row_html,this_shuffle];\r\n  }\r\n}\r\n\r\nfunction process_score(row_no, values_col, this_response, item, values_reverse ){\r\n  item_values = survey_obj.data[row_no][values_col].split(\"|\");\r\n  if(typeof(values_reverse) !== \"undefined\" && values_reverse == \"r\"){\r\n    item_values.reverse();\r\n  }\r\n  item_answers      = survey_obj.data[row_no][\"values\"].split(\"|\");\r\n  var this_value    = item_values[item_answers.indexOf(this_response)];\r\n  $(\"#survey_\" + item + \"_score\").val(this_value);\r\n  if(typeof(this_value) !== \"undefined\"){\r\n    return parseFloat(this_value);\r\n  }\r\n}\r\n\r\nfunction process_returned_questionnaire(data){\r\n  /*\r\n  * trim the data if it has a blank final row\r\n  */\r\n  if(data[data.length - 1].length < data[0].length){\r\n    data.pop();\r\n  }\r\n\r\n  survey_obj.data = data;\r\n  survey_obj.data = Papa.unparse(survey_obj.data);\r\n  survey_obj.data = parent.parent.Collector.PapaParsed(survey_obj.data);\r\n\r\n  survey_obj.scales = {};\r\n  var col_headers = Object.keys(survey_obj.data[0]);\r\n  col_headers.forEach(function(header){\r\n    if(header.indexOf(\"score:\")==0){\r\n      var original_header = header;\r\n      header = header.replace(\"score: \",\"\");\r\n      header = header.replace(\"score:\",\"\");\r\n      survey_obj.scales[header] = {};\r\n      survey_obj.scales[header].questions = {};\r\n\r\n      for(var i = 1; i < survey_obj.data.length; i++){\r\n        row = survey_obj.data[i];\r\n        if(row[original_header] !== \"\" && typeof(row[original_header]) !== \"undefined\"){\r\n          survey_obj.scales[header].questions[i] = row[original_header];\r\n        }\r\n      }\r\n    }\r\n  });\r\n  write_survey(survey_obj.data,\"this_survey_id\");\r\n  $(\"#please_wait_div\").hide();\r\n  $(\"#proceed_button\").show();\r\n  $('html, body').animate({\r\n    scrollTop: $(\"#survey_outline\").offset().top\r\n  }, 1000);\r\n}\r\n\r\nfunction row_perc(this_rat){\r\n\tif(typeof(this_rat) == \"undefined\"){\r\n    row_resp_perc = \"50%\";\r\n    row_ques_perc = \"50%\";\r\n  } else {\r\n    row_resp_perc = parseFloat(100-this_rat.replace(\"%\",\"\"))+\"%\";\r\n    row_ques_perc = parseFloat(this_rat.replace(\"%\",\"\"))+\"%\";\r\n  }\r\n  return [row_ques_perc,row_resp_perc];\r\n}\r\n\r\nfunction response_check(submitted_element){\r\n  switch(submitted_element.type){\r\n    case \"checkbox\":\r\n\r\n      var checked_responses = $(\"[name='\"+submitted_element.name+\"']:checked\");\r\n      if(checked_responses.length){ //i.e. more than 0\r\n        var values = [];\r\n        for(var i = 0; i < checked_responses.length; i++){\r\n          values.push(checked_responses[i].value);\r\n        }\r\n        $(\"#\"+submitted_element.name+\"_response\").val(\r\n          JSON.stringify(values)\r\n        );\r\n      } else {\r\n        $(\"#\"+submitted_element.name+\"_response\").val(\"\");\r\n      }\r\n      break;\r\n\r\n      case \"button\":\r\n        $(\"#\" + submitted_element.name + \"_response\").val(\r\n          submitted_element.value\r\n        );\r\n      break;\r\n\r\n      case \"number\":\r\n      case \"radio\":\r\n      case \"select-one\":\r\n      case \"text\":\r\n      case \"textarea\":\r\n        $(\"#\" + submitted_element.name + \"_response\").val(\r\n          submitted_element.value\r\n        );\r\n      break;\r\n    }\r\n    update_score();\r\n}\r\n\r\nfunction retrieve_row_no_item_name(this_element){\r\n  var these_classes = this_element.className.split(\" \");\r\n  var row_no;\r\n  var item_name;\r\n  these_classes.forEach(function(this_class){\r\n    if (this_class.indexOf('row_') > -1) {\r\n      row_no = this_class.replace(\"row_\",\"\");\r\n    }\r\n    if (this_class.indexOf('_item') > -1) {\r\n      item_name = this_class.replace(\"_item\",\"\").toLowerCase();\r\n    }\r\n  });\r\n  return [row_no,item_name];\r\n}\r\n\r\nfunction reveal_answers(this_element){\r\n  var this_response = $(\"#\" + this_element.id.replace(\r\n    \"reveal_\",\r\n    \"survey_\"\r\n  ).replace(\"_feedback\",\"_response\")).val();\r\n  response_present = this_response == \"\" ? false : true;\r\n\r\n  if(settings.feedback_before_response == false && response_present == false){\r\n    bootbox.alert(\"Please respond before trying reveal the feedback.\")\r\n  } else {\r\n    if($(\"#\" + this_element . id).hasClass(\"btn-outline-info\")){\r\n      $(\".\" + this_element.id.replace(\"reveal_\",\"\")).show(500);\r\n      if(settings.lock_after_feedback){\r\n        var item_class = this_element.id.replace(\"_feedback\",\"_item\").replace(\"reveal_\",\"\");\r\n        $(\".\"+item_class).prop(\"disabled\",true);\r\n        document.getElementsByClassName(item_class).title = \"The person creating this content has set it so that your answers are locked in once you have chosen to see the feedback\";\r\n        $(\"#\"+this_element.id).addClass(\"btn-info\")\r\n          .removeClass(\"btn-outline-info\")\r\n          .html(\"Locked\");\r\n        document.getElementById(this_element.id).title = 'The person creating this content has set it so that your answers are locked in once you have chosen to see the feedback';\r\n        $(\"#\"+this_element.id).addClass(\"disabled\");\r\n      } else {\r\n        $(\"#\"+this_element.id).html(\"Hide\")\r\n          .removeClass(\"btn-outline-info\")\r\n          .addClass(\"btn-info\");\r\n      }\r\n    } else {\r\n      $(\".\"+this_element.id.replace(\"reveal_\",\"\")).hide(500);\r\n      $(\"#\"+this_element.id).html(\"Show\")\r\n        .addClass(\"btn-outline-info\")\r\n        .removeClass(\"btn-info\");\r\n    }\r\n  }\r\n}\r\n\r\nfunction row_check(type, row){\r\n  if(type = \"page_break\"){\r\n    return (\r\n      typeof(row[\"text\"]) !== \"undefined\" &&\r\n\t\t  typeof(row[\"type\"]) !== \"undefined\" &&\r\n\t\t  row['text'].toLowerCase() == \"page_break\" |\r\n      row['type'].toLowerCase() == \"page_break\"\r\n    );\r\n  } else if(type=\"\"){\r\n    //do nothing\r\n  }\r\n}\r\n\r\n// http://stackoverflow.com/questions/962802#962890\r\nfunction shuffle(array) {\r\n  var tmp, current, top = array.length;\r\n  if(top) while(--top) {\r\n    current = Math.floor(Math.random() * (top + 1));\r\n    tmp = array[current];\r\n    array[current] = array[top];\r\n    array[top] = tmp;\r\n  }\r\n  return array;\r\n}\r\n\r\nfunction shuffle_answers(row){\r\n  if(\r\n    typeof(row[\"shuffle_answers\"]) !== \"undefined\" &&\r\n    row[\"shuffle_answers\"].toLowerCase() == \"yes\"\r\n  ){\r\n    var answers = row[\"answers\"].split(\"|\");\r\n    order = shuffle([...Array(answers.length).keys()]);\r\n\r\n    var ordered_answers = order.map(function(position){\r\n      return answers[position];\r\n    });\r\n    row[\"answers\"] = ordered_answers.join(\"|\");\r\n\r\n    if(row[\"values\"].indexOf(\"|\") !== -1){\r\n      var values = row[\"values\"].split(\"|\");\r\n      var ordered_values = order.map(function(position){\r\n        return values[position];\r\n      });\r\n      row[\"values\"] = ordered_values.join(\"|\");\r\n    }\r\n  }\r\n  return row;\r\n}\r\n\r\nfunction update_score(){\r\n  var scales = Object.keys(survey_obj.scales);\r\n  scales.forEach(function(scale){\r\n    this_scale = survey_obj.scales[scale];\r\n    var questions = Object.keys(this_scale.questions);\r\n    var this_score = 0;\r\n    complete_score = true;\r\n\r\n    questions.forEach(function(row_no){\r\n      var item = survey_obj.data[row_no].item_name.toLowerCase();\r\n      var this_response = $(\"#survey_\" + item + \"_value\").val();\r\n      var normal_reverse = this_scale.questions[row_no];\r\n\r\n\r\n      if(normal_reverse.indexOf(\"-\") == -1){\r\n        var multiplier = parseFloat(normal_reverse.replace(\"r\",\"\"));\r\n        if(normal_reverse.indexOf(\"r\") == 0){ //reverse the values\r\n\r\n          this_value = process_score(\r\n            row_no,\r\n            \"values\",\r\n            this_response,\r\n            item,\r\n            \"r\"\r\n          );\r\n        } else {\r\n          this_value = process_score(\r\n            row_no,\r\n            \"values\",\r\n            this_response,\r\n            item\r\n          );\r\n        }\r\n      } else {\r\n        values_reverse = normal_reverse.split(\"-\");\r\n        values_col     = values_reverse[0].toLowerCase();\r\n        normal_reverse = values_reverse[1];\r\n        var multiplier = parseFloat(normal_reverse.replace(\"r\",\"\"));\r\n\r\n        if(normal_reverse.indexOf(\"r\") == 0){ //reverse the values\r\n          this_value = process_score(row_no,values_col,this_response,item,\"r\");\r\n        } else {\r\n          this_value = process_score(row_no,values_col,this_response,item);\r\n        }\r\n      }\r\n      if(typeof(this_value) !== \"undefined\"){\r\n        this_score += multiplier * this_value;\r\n      } else {\r\n        complete_score = false;\r\n      }\r\n    });\r\n    if(complete_score){\r\n      $(\".score_\"+scale).addClass(\"bg-success\")\r\n        .removeClass(\"bg-danger\")\r\n        .addClass(\"text-light\")\r\n        .prop(\"title\", \"All relevant questions have been answered\");\r\n    } else {\r\n      $(\".score_\"+scale).removeClass(\"text-success\")\r\n        .addClass(\"bg-danger\")\r\n        .addClass(\"text-light\")\r\n        .prop(\"title\",\"At least one relevant questions has NOT been answered\");\r\n    }\r\n    $(\".score_\" + scale).val(this_score);\r\n  });\r\n}\r\n\r\nfunction write(type, row){\r\n  var this_html = \"\";\r\n  [feedback_array, feedback_color] = get_feedback(row);\r\n  row = shuffle_answers(row);\r\n  row[\"item_name\"] = row[\"item_name\"].toLowerCase();\r\n\r\n\r\n  if(type == \"checkbox_horizontal\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_table = $(\"<table>\");\r\n        this_row = this_table[0].insertRow()\r\n    for(var i=0; i<options.length;i++){\r\n      var this_cell = this_row.insertCell();\r\n      var this_div = $(\"<div>\");\r\n          this_div.addClass(\"custom-control\");\r\n          this_div.addClass(\"custom-checkbox\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type = \"checkbox\";\r\n          this_input[0].id = row[\"item_name\"] + i;\r\n          this_input[0].name = 'survey_' + row[\"item_name\"];\r\n          this_input.addClass(\"custom-control-input\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(row[\"custom-control\"])\r\n            .addClass(row[\"custom-checkbox\"])\r\n            .addClass(row[\"item_name\"] +'_item')\r\n            .addClass('row_' + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerText = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_input)\r\n              .append(this_label);\r\n      this_cell.innerHTML = this_div[0].outerHTML;\r\n    }\r\n\r\n    this_html += this_table[0].outerHTML;\r\n\r\n  } else if(type == \"checkbox_single\"){\r\n\r\n    var this_div = $(\"<div>\");\r\n        this_div.attr(\"data-toggle\", \"buttons\");\r\n        this_div.addClass(\"btn-group-toggle\");\r\n    var this_label = $(\"<label>\");\r\n        this_label.addClass(\"btn\");\r\n        this_label.addClass(\"btn-outline-primary\");\r\n        this_label.html(row[\"answers\"]);\r\n    var this_checkbox = $(\"<input>\");\r\n        this_checkbox[0].id = row[\"item_name\"];\r\n        this_checkbox[0].name = \"survey_\" +\r\n          row[\"item_name\"].toLowerCase();\r\n        this_checkbox[0].type = \"checkbox\";\r\n        this_checkbox.attr(\"checked\",true);\r\n        this_checkbox\r\n          .addClass(\"response\")\r\n          .addClass(\r\n            row[\"item_name\"] +\r\n            '_item row_' +\r\n            row[\"row_no\"]\r\n          );\r\n    this_div.append(this_label);\r\n    this_label.append(this_checkbox)\r\n    this_html += this_div[0].outerHTML;\r\n\r\n  } else if(type == \"checkbox_vertical\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i = 0; i < options.length; i++){\r\n      feedback_string = generate_feedback_string(\r\n        feedback_array, i, feedback_color, row\r\n      );\r\n      var this_div = $(\"<div>\");\r\n          this_div\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-checkbox\");\r\n      var this_checkbox = $(\"<input>\");\r\n          this_checkbox[0].id= row[\"item_name\"]+ i;\r\n          this_checkbox[0].value = options[i];\r\n          this_checkbox[0].type = \"checkbox\";\r\n          this_checkbox[0].name = 'survey_'+\r\n            row[\"item_name\"].toLowerCase();\r\n          this_checkbox\r\n            .addClass(\"custom-control-input\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-checkbox\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"item_name\"] + \"_item_row\");\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerHTML = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_checkbox)\r\n              .append(this_label);\r\n\r\n      this_html += this_div[0].outerHTML;\r\n    }\r\n    if(typeof(row[\"other\"]) !== \"undefined\" && row[\"other\"].toLowerCase() == \"yes\"){\r\n      var this_div = $(\"<div>\");\r\n          this_div\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-checkbox\");\r\n      var this_checkbox = $(\"<input>\");\r\n          this_checkbox[0].id= row[\"item_name\"]+ \"_other\";\r\n          this_checkbox[0].value = \"Other\";\r\n          this_checkbox[0].type = \"checkbox\";\r\n          this_checkbox[0].name = 'survey_'+\r\n            row[\"item_name\"].toLowerCase();\r\n          this_checkbox\r\n            .addClass(\"custom-control-input\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-checkbox\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"item_name\"] + \"_item_row\");\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + \"_other\";\r\n          this_label[0].innerHTML = \"Other\";\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_checkbox)\r\n              .append(this_label);\r\n\r\n      this_html += this_div[0].outerHTML;\r\n\r\n      var text_input = $(\"<input>\");\r\n          text_input.addClass(\"form-control\");\r\n          text_input.attr(\"placeholder\", \"(Please specify if you selected 'Other')\");\r\n          text_input[0].name = 'survey_'+\r\n            row[\"item_name\"].toLowerCase() +\r\n            \"_other\";\r\n      this_html += text_input[0].outerHTML;\r\n    }\r\n\r\n  } else if(type == \"date\"){\r\n    var input = $(\"<input>\");\r\n        input.addClass(\"response\")\r\n             .addClass(\"custom-control\")\r\n             .addClass(\"datepicker\")\r\n             .addClass(\"date\")\r\n             .addClass(row[\"item_name\"] + \"_item\")\r\n             .addClass(\"row_\" + row[\"row_no\"])\r\n             .attr(\"name\", \"survey_\" + row['item_name'])\r\n             .attr(\"type\", \"text\");\r\n\r\n  } else if(type == \"dropdown\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_dropdown = $(\"<select>\");\r\n        this_dropdown\r\n          .addClass(\"form-select\")\r\n          .addClass(\"response\")\r\n          .addClass(\"txt-primary\")\r\n          .addClass(row[\"item_name\"] + \"_item\")\r\n          .addClass(\"row_\" + row[\"row_no\"])\r\n          .addClass(\"collector_button\")\r\n          .attr(\"name\", \"survey_\" + row[\"item_name\"])\r\n          .css(\"margin\", \"0px\")\r\n          .css(\"width\", \"auto\");\r\n\r\n    /* this will be necessary to tidy up jumbled sentences\r\n    if(typeof(row[\"item_name_old\"]) !== \"undefined\"){\r\n      this_dropdown.addClass(row[\"item_name_old\"] + \"_item\");\r\n    }\r\n    */\r\n\r\n    this_dropdown.append(\"<option selected disabled hidden>-- no option selected --</option>\");\r\n    options.forEach(function(this_option){\r\n      this_dropdown.append(\r\n        \"<option>\" + this_option + \"</option>\"\r\n      );\r\n    });\r\n    var this_html = this_dropdown[0].outerHTML;\r\n\r\n  } else if(type == \"email\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input\r\n          .addClass(\"form-control\")\r\n          .addClass(\"response\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .attr(\"type\", \"email\")\r\n          .attr(\"name\", 'survey_' + row['item_name']);\r\n\r\n  } else if(type == \"instruct\"){\r\n    this_html += \"<td colspan='2'>\" + row[\"text\"] + \"</td>\";\r\n  } else if(type == \"jumbled\"){\r\n    var this_td = $(\"<td>\");\r\n        this_td.attr(\"colspan\",2) ;\r\n\r\n    var this_div = $(\"<div>\");\r\n        this_div.addClass(\"form-inline\")\r\n                .addClass(\"bg-secondary\")\r\n                .addClass(\"text-white\")\r\n                .css(\"width\", \"100%\")\r\n                .css(\"padding\", \"20px\")\r\n                .css(\"margin\", \"20px\")\r\n                .css(\"border-radius\", \"5px\");\r\n\r\n    var question = row[\"text\"].split(\"|\");\r\n    questions_html = question.map(function(text,index){\r\n      if(index == question.length - 1){\r\n        return text;\r\n      } else {\r\n        var row_x = row;\r\n        row_x[\"item_name_old\"] = row_x[\"item_name\"];\r\n        row_x[\"item_name\"]     = row_x[\"item_name\"] + \"_\" + index;\r\n        var row_html = text + write(\"dropdown\", row_x)\r\n          .replace(\"margin: 0px\",\"margin: 5px\");\r\n        row_x[\"item_name\"] = row_x[\"item_name_old\"];\r\n        return row_html;\r\n      }\r\n    }).join(\"\");\r\n\r\n    this_td.append(this_div);\r\n    this_div.append(questions_html);\r\n\r\n    this_html = this_td[0].outerHTML;\r\n\r\n  } else if(type == \"likert\"){\r\n    // set styles\r\n    if(typeof(row[\"btn_width\"]) == \"undefined\"){\r\n      row[\"btn_width\"] = \"auto\"\r\n    }\r\n    if(typeof(row[\"side_width\"]) == \"undefined\"){\r\n      var side_width = \"auto\";\r\n    }\r\n\r\n    // create and build these elements\r\n    var this_div = $(\"<div>\");\r\n    if(typeof(row[\"side_text\"]) !== \"undefined\" &&\r\n      row[\"side_text\"] !== \"\"\r\n    ){\r\n      side_text = row[\"side_text\"].split(\"|\");\r\n      side_text = side_text.map(function(this_side){\r\n        var this_span = $(\"<span>\");\r\n            this_span.css(\"width\", side_width)\r\n              .css(\"padding\", \"20px\")\r\n              .addClass(\"text-primary\")\r\n              .html(\"<b>\" + this_side + \"</b>\");\r\n        return this_span[0].outerHTML;\r\n      });\r\n    } else {\r\n      side_text = [\"\",\"\"];\r\n    }\r\n\r\n    this_div\r\n      .addClass(\"btn-group\")\r\n      .addClass(\"btn-group-toggle\")\r\n      .append(side_text[0])\r\n      .attr(\"data-togle\",\"buttons\");\r\n\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i=0; i<options.length;i++){\r\n      var this_button = $(\"<button>\");\r\n          this_button\r\n            .attr(\"autocomplete\", \"off\")\r\n            .attr(\"id\", 'likert_' + row[\"row_no\"] + '_' + i)\r\n            .attr(\"onclick\",'likert_update(this)')\r\n            .attr(\"value\", values[i])\r\n            .addClass(\"btn\")\r\n            .addClass(\"btn-outline-primary\")\r\n            .addClass(\"survey_btn\")\r\n            .addClass(\r\n              row[\"item_name\"] + '_item row_' + row[\"row_no\"]\r\n            )\r\n            .css(\"width\", row[\"btn_width\"])\r\n            .html(clean_item(options[i]));\r\n      this_div.append(this_button);\r\n    }\r\n    this_div.append(side_text[1]);\r\n    this_html += this_div[0].outerHTML;\r\n\r\n  } else if(type == \"number\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input[0].type = \"number\";\r\n        this_input[0].name = 'survey_' + row['item_name'];\r\n        this_input\r\n          .addClass(\"response\")\r\n          .addClass(\"form-control\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"]);\r\n    this_html += this_input[0].outerHTML;\r\n\r\n  } else if(type == \"para\"){\r\n    var this_textarea = $(\"<textarea>\");\r\n        this_textarea[0].name = \"survey_\" + row['item_name'];\r\n        this_textarea\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .addClass(\"response\");\r\n        this_textarea.css(\"width\", \"100%\")\r\n                     .css(\"height\", \"200px\");\r\n    this_html += this_textarea[0].outerHTML;\r\n\r\n  } else if(type == \"radio_horizontal\"){\r\n\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_table = $(\"<table>\");\r\n        this_row = this_table[0].insertRow()\r\n    for(var i=0; i<options.length;i++){\r\n      var this_cell = this_row.insertCell();\r\n      var this_div = $(\"<div>\");\r\n          this_div.addClass(\"custom-control\");\r\n          this_div.addClass(\"custom-radio\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type = \"radio\";\r\n          this_input[0].id = row[\"item_name\"] + i;\r\n          this_input[0].name = 'survey_' + row[\"item_name\"];\r\n          this_input.addClass(\"custom-control-input\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(row[\"custom-control\"])\r\n            .addClass(row[\"custom-radio\"])\r\n            .addClass(row[\"item_name\"] +'_item')\r\n            .addClass('row_' + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerText = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_input)\r\n              .append(this_label);\r\n      this_cell.innerHTML = this_div[0].outerHTML;\r\n    }\r\n    this_html += this_table[0].outerHTML;\r\n\r\n  } else if(type == \"radio_vertical\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i=0; i<options.length; i++){\r\n      feedback_string = generate_feedback_string(\r\n        feedback_array, i, feedback_color,row\r\n      );\r\n      var this_div = $(\"<div>\");\r\n          this_div\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-radio\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type  = \"radio\";\r\n          this_input[0].id    = row[\"item_name\"] + i;\r\n          this_input[0].value = options[i];\r\n          this_input[0].name  = 'survey_' + row[\"item_name\"];\r\n          this_input\r\n            .addClass(\"custom-control-input\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-radio\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"item_name\"] + \"_item_row_\" + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"]+i;\r\n          this_label.addClass(\"custom-control-label\");\r\n          this_label.html(options[i]);\r\n      this_div\r\n        .append(this_input)\r\n        .append(this_label)\r\n        .append(feedback_string);\r\n      this_html += this_div[0].outerHTML;\r\n    }\r\n\r\n  } else if(type == \"text\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input[0].type=\"text\";\r\n        this_input[0].name=\"survey_\" + row['item_name'];\r\n        this_input\r\n          .addClass(\"form-control\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .addClass(\"response\")\r\n    this_html += this_input[0].outerHTML;\r\n  }\r\n\r\n  switch(type){\r\n    case \"checkbox_vertical\":\r\n    case \"radio_vertical\":\r\n      // do nothing\r\n      break;\r\n    default:\r\n      this_html += generate_feedback_string(\r\n        feedback_array,\r\n        0,\r\n        feedback_color,\r\n        row\r\n      );\r\n      break;\r\n  }\r\n\r\n  return (this_html);\r\n}\r\n\r\nfunction write_survey(this_survey, this_id){\r\n  scoring_object.update_scales(this_survey);\r\n  survey_html = \"<table class='table_break' id='table0'>\";\r\n  this_survey_object={\r\n    content:[],\r\n    shuffle_question:[],\r\n    content_new_order:[],\r\n    shuffled_content:[],\r\n    shuffled_arrays:{},\r\n  }\r\n\r\n  survey_html += \"<tr>\";\r\n  for(i = 0; i < this_survey.length; i++){\r\n    row = this_survey[i];\r\n    row_html = process_question(row,i);\r\n\t\tthis_survey_object.content.push(row_html[0]);\r\n    this_survey_object.shuffle_question.push(row_html[1]);\r\n\t}\r\n\r\n\tunique_shuffles = this_survey_object.shuffle_question.filter((v,i,a)=>a.indexOf(v)==i); //by Camilo Martin on https://stackoverflow.com/questions/1960473/unique-values-in-an-array\r\n\r\n\tfor(var i=0;i<unique_shuffles.length;i++){\r\n    if(typeof(unique_shuffles[i]) !== \"undefined\" &&\r\n      unique_shuffles[i] !== \"none\" &&\r\n      unique_shuffles[i] !== \"\"){\r\n        shuffled_content = this_survey_object.shuffle_question.map(function(element,index){\r\n    \t   if(typeof(element)!== \"undefined\" && element.toLowerCase() !== \"none\" && element.toLowerCase() == unique_shuffles[i]){\r\n  \t       return this_survey_object.content[index];\r\n    \t   }\r\n    \t}).filter(elm => typeof(elm) !== \"undefined\");\r\n    \tnew_order = shuffle(shuffled_content);\r\n    \tthis_survey_object.shuffled_arrays[unique_shuffles[i]]=new_order; // add new array with dynamic name\r\n    }\r\n\t}\r\n\r\n\tfor(var i=0;i<this_survey_object.content.length;i++){\r\n    var this_index = Object.keys(this_survey_object.shuffled_arrays).indexOf(this_survey_object.shuffle_question[i]);\r\n    if(this_index !== -1){\r\n      //take first item off relevant list and delete item\r\n      var this_item = this_survey_object.shuffled_arrays[Object.keys(this_survey_object.shuffled_arrays)[this_index]].shift();\r\n      this_survey_object.content_new_order[i]=this_item;\r\n    } else {\r\n      this_survey_object.content_new_order[i]=this_survey_object.content[i];\r\n    }\r\n\t}\r\n\r\n\tqs_in_order = this_survey_object.content_new_order.join(\"</tr><tr>\");\r\n\tqs_in_order += \"</tr>\";\r\n\r\n\tsurvey_html += qs_in_order;\r\n\tsurvey_html += \"</table>\";\r\n\r\n\t$(\"#\" + this_id).html(survey_html);\r\n\r\n  $(\".response\").on(\"change\", function(){\r\n    response_check(this);\r\n  })\r\n\r\n  $(\"#\" + this_id).show(1000); //scroll to top\r\n\r\n\t$(\".show_tab\").on(\"click\",function(){\r\n    if(this.className.indexOf(\"disabled\") == -1){\r\n      $(\".show_tab\").removeClass(\"active\");\r\n      $(\".survey_page\").hide();\r\n      $(\"#\"+this.id.replace(\"_button\",\"\")).show();\r\n    } else {\r\n      bootbox.alert(\"You have not yet unlocked this tab - maybe try clicking on <b>Proceed</b>?\");\r\n    }\r\n\t});\r\n}\r\n\r\n/*\r\n* Load survey\r\n*/\r\ncurrent_survey = \"{{survey}}\";\r\nif(typeof(Phase) !== \"undefined\"){\r\n  Phase.set_timer(function(){\r\n    load_survey(current_survey);\r\n  },100);\r\n} else {\r\n  load_survey(current_survey);\r\n}\r\n</script>\r\n"
  },
  "mods": {},
  "procs_csv": {},
  "stims_csv": {}
}